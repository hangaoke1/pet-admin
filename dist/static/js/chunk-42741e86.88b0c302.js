(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-42741e86"],{"0bfa":function(e,t,i){},1800:function(e,t,i){"use strict";var a=i("b04e"),n=i.n(a);n.a},"206c":function(e,t,i){},"22ce":function(e,t,i){"use strict";var a=i("365c");t["a"]={queryList:function(e){return a["a"].post("/admin/meal/queryList",e)},queryTreeList:function(e){return a["a"].post("/admin/meal/queryTreeList",e)},del:function(e){return a["a"].get("/admin/meal/del",e)},saveOrUpdate:function(e){return a["a"].post("/admin/meal/saveOrUpdate",e)},onlineList:function(e){return a["a"].get("/pet/mealList",e)},onlineSaveOrUpdate:function(e){return a["a"].post("/admin/meal/alone/saveOrUpdate",e)},onlineDelete:function(e){return a["a"].get("/admin/meal/alone/del",e)}}},"27eec":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"u-cash flex flex-column p-2 bg-bai"},[i("bill-menu",{staticClass:"flex-0",attrs:{list:e.bills},on:{add:e.addBill,delete:e.delBill},model:{value:e.billId,callback:function(t){e.billId=t},expression:"billId"}}),e._v(" "),i("div",{staticClass:"flex-1 flex bg-bai p-2",staticStyle:{height:"0"}},[i("div",{staticClass:"flex-1 mr-2"},[i("div",{staticClass:"flex-0 flex justify-between align-center"},[i("div",{staticClass:"flex-0"},[i("el-button",{staticClass:"yc-btn",staticStyle:{width:"120px"},on:{click:e.showSkuChoose}},[e._v("选购")]),e._v(" "),i("el-button",{staticClass:"yc-del",on:{click:e.addSpecalSku}},[e._v("添加差价商品")])],1),e._v(" "),i("el-input",{staticClass:"yc-input",staticStyle:{width:"200px"},attrs:{placeholder:"请输入条形码","suffix-icon":"el-icon-search"},on:{focus:function(t){e.isStart=!1},blur:function(t){e.isStart=!0}},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.addSku(t)}},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}})],1),e._v(" "),i("div",{staticClass:"mt-2 flex-1"},[i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{"element-loading-text":"商品查询中","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0)",height:"calc(100vh - 320px)",data:e.activeBill.list}},[i("el-table-column",{attrs:{prop:"name",label:"商品/服务",width:"180",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[3!==t.row.productType?i("span",{staticClass:"font-weight-bold"},[e._v(e._s(t.row.name))]):i("el-input",{staticClass:"text-center font-weight-bold",attrs:{size:"mini"},model:{value:t.row.name,callback:function(i){e.$set(t.row,"name",i)},expression:"scope.row.name"}})]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"count",label:"数量",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[i("el-input-number",{staticClass:"f-number",staticStyle:{width:"80px"},attrs:{"controls-position":"right",size:"mini",min:1,max:99999},on:{change:function(t){return e.calcChange(a,"quantity")}},model:{value:a.quantity,callback:function(t){e.$set(a,"quantity",e._n(t))},expression:"row.quantity"}})]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"price",label:"零售价(元)",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[i("span",{staticClass:"f-number"},[e._v(e._s(e._f("numFixed2")(a.price)))])]}}])}),e._v(" "),i("el-table-column",{attrs:{label:"折扣率(%)",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[i("el-input",{staticClass:"f-number text-center",staticStyle:{width:"100px"},attrs:{size:"small"},on:{change:function(t){return e.calcChange(a,"percent")}},model:{value:a.percent,callback:function(t){e.$set(a,"percent",t)},expression:"row.percent"}})]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"price",label:"折后价(元)",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[i("el-input",{staticClass:"f-number text-center",staticStyle:{width:"100px"},attrs:{size:"small"},on:{change:function(t){return e.calcChange(a,"memberPrice")}},model:{value:a.memberPrice,callback:function(t){e.$set(a,"memberPrice",t)},expression:"row.memberPrice"}})]}}])}),e._v(" "),i("el-table-column",{attrs:{label:"小计(元)",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[i("el-input",{staticClass:"f-number text-center",staticStyle:{width:"100px"},attrs:{size:"small"},on:{change:function(t){return e.calcChange(a,"total")}},model:{value:a.total,callback:function(t){e.$set(a,"total",t)},expression:"row.total"}})]}}])}),e._v(" "),i("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[i("el-button",{attrs:{type:"danger",icon:"el-icon-delete",circle:"",size:"mini"},on:{click:function(t){return e.deleteSku(a)}}})]}}])}),e._v(" "),i("div",{attrs:{slot:"empty"},slot:"empty"},[e._v("请添加商品")])],1)],1)]),e._v(" "),i("div",{staticClass:"u-vipMember flex-0 p-2",staticStyle:{width:"350px"}},[e.vipMember?i("div",{staticClass:"flex flex-column",staticStyle:{height:"100%"}},[i("span",{staticClass:"u-vipMember__close el-icon-circle-close",on:{click:e.delVipMember}}),e._v(" "),i("div",{staticClass:"u-vipInfo mb-2 flex-0"},[i("div",{staticClass:"u-vipInfo__user flex"},[i("el-avatar",{staticClass:"mr-1",attrs:{size:50,src:e.vipMember.avatar}}),e._v(" "),i("div",[i("div",{staticClass:"u-vipInfo__name"},[e._v(e._s(e.vipMember.nickname))]),e._v(" "),i("div",{staticClass:"u-vipInfo__level"},[e._v(e._s(e.vipMember.vipName))])])],1)]),e._v(" "),i("yc-tabs",{staticClass:"flex-0",attrs:{options:["会员概况","宠物信息"].map((function(e){return{label:e,value:e}}))},model:{value:e.vipMemberTab,callback:function(t){e.vipMemberTab=t},expression:"vipMemberTab"}}),e._v(" "),i("yc-block",{staticClass:"flex-1",staticStyle:{"overflow-y":"auto"}},["会员概况"===e.vipMemberTab?i("div",[i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:8}},[i("div",{staticClass:"u-vipInfo__base"},[i("div",{staticClass:"u-vipInfo__label"},[e._v("会员余额")]),e._v(" "),i("div",{staticClass:"u-vipInfo__value"},[e._v(e._s(e._f("numFixed2")(e.vipMember.balance)))])])]),e._v(" "),i("el-col",{attrs:{span:8}},[i("div",{staticClass:"u-vipInfo__base"},[i("div",{staticClass:"u-vipInfo__label"},[e._v("会员等级")]),e._v(" "),i("div",{staticClass:"u-vipInfo__value"},[e._v(e._s(e.vipMember.vipName))])])]),e._v(" "),i("el-col",{attrs:{span:8}},[i("div",{staticClass:"u-vipInfo__base"},[i("div",{staticClass:"u-vipInfo__label"},[e._v("宠物数量")]),e._v(" "),i("div",{staticClass:"u-vipInfo__value"},[e._v(e._s(e.vipMember.petRecordList?e.vipMember.petRecordList.length:0))])])])],1)],1):e._e(),e._v(" "),"宠物信息"===e.vipMemberTab?i("div",e._l(e.vipMember.petRecordList||[],(function(e){return i("pet-item",{key:e.id,attrs:{info:e}})})),1):e._e()])],1):i("div",{staticClass:"text-center"},[i("el-button",{staticClass:"yc-btn mt-2",on:{click:e.handleChooseUser}},[e._v("会员选择")])],1)])]),e._v(" "),i("div",{staticClass:"u-footer flex-0 flex align-center justify-between"},[i("div",[i("el-button",{staticClass:"yc-del",on:{click:e.doEmpty}},[e._v("清空列表")])],1),e._v(" "),i("div",[i("button",{staticClass:"u-calc f-number",on:{click:e.doSubmit}},[i("span",{staticClass:"mr-1"},[e._v("结算")]),e._v(" "),i("span",[e._v("¥")]),e._v(" "),i("span",{staticClass:"font-s-28"},[e._v(e._s(e._f("numFixed2")(e.billTotal)))])])])]),e._v(" "),i("yc-user-choose",{ref:"userChoose",attrs:{single:""},model:{value:e.vipMember,callback:function(t){e.vipMember=t},expression:"vipMember"}}),e._v(" "),i("sku-choose",{ref:"skuChoose",on:{close:function(t){e.isStart=!0},choose:e.handleAddSku}}),e._v(" "),i("el-dialog",{attrs:{title:"确认订单",width:"950px","close-on-click-modal":!1,visible:e.showConfrim},on:{"update:visible":function(t){e.showConfrim=t}}},[i("div",{staticClass:"flex"},[i("div",{staticClass:"flex-1 u-confirm__left"},[i("el-table",{staticStyle:{width:"100%"},attrs:{size:"mini",data:e.activeBill.list,height:"300"}},[i("el-table-column",{attrs:{prop:"name",align:"center",label:"商品/服务"}}),e._v(" "),i("el-table-column",{attrs:{prop:"quantity",align:"center",label:"数量"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[i("span",{staticClass:"f-number"},[e._v(e._s(a.quantity))])]}}])}),e._v(" "),i("el-table-column",{attrs:{label:"实付金额(元)",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[i("span",{staticClass:"f-number"},[e._v(e._s(e._f("numFixed2")(a.total)))])]}}])})],1)],1),e._v(" "),i("div",{staticClass:"flex-1 u-confirm__right"},[i("div",{staticClass:"u-confirm__vip"},[i("div",{staticClass:"u-confirm__info"},[e.vipMember?i("div",[i("div",{staticClass:"u-vipInfo__user flex"},[i("el-avatar",{staticClass:"mr-1",attrs:{size:50,src:e.vipMember.avatar}}),e._v(" "),i("div",[i("div",{staticClass:"u-vipInfo__name"},[e._v(e._s(e.vipMember.nickname))]),e._v(" "),i("div",{staticClass:"u-vipInfo__level"},[e._v(e._s(e.vipMember.vipName))])])],1),e._v(" "),i("div",{staticClass:"mt-2"},[i("span",[e._v("卡内余额：")]),e._v(" "),i("span",{staticClass:"f-number"},[e._v(e._s(e._f("numFixed2")(e.vipMember.balance)))])])]):i("div",[e._v("散客")])]),e._v(" "),i("div",{staticClass:"u-pay mt-2"},e._l(e.showPayList,(function(t){return i("div",{key:t.label,staticClass:"u-pay__item",class:{"u-pay__active":t.value===e.payType},on:{click:function(i){e.payType=t.value}}},[i("el-avatar",{attrs:{src:t.icon}}),e._v(" "),i("div",{staticClass:"mt-1 font-weight-bold"},[e._v(e._s(t.label))])],1)})),0),e._v(" "),i("div",{staticClass:"mt-2 flex align-center justify-between"},[i("div",{staticClass:"flex align-center mr-1"},[i("span",{staticClass:"font-s-11"},[e._v("销售时间：")]),e._v(" "),i("el-date-picker",{staticStyle:{width:"190px"},attrs:{size:"mini",type:"datetime",placeholder:"选择日期时间"},model:{value:e.saleTime,callback:function(t){e.saleTime=t},expression:"saleTime"}})],1),e._v(" "),i("div",{staticClass:"flex align-center"},[i("el-checkbox",{attrs:{size:"mini"},model:{value:e.needPrint,callback:function(t){e.needPrint=t},expression:"needPrint"}},[e._v("打印小票")]),e._v(" "),i("el-input-number",{staticClass:"ml-1 f-number",staticStyle:{width:"60px"},attrs:{"controls-position":"right",size:"mini",min:1,max:10},model:{value:e.printCount,callback:function(t){e.printCount=t},expression:"printCount"}})],1)])]),e._v(" "),i("div",{staticClass:"u-confirm__pay"})])]),e._v(" "),i("span",{staticClass:"flex align-center justify-end",attrs:{slot:"footer"},slot:"footer"},[i("span",{staticClass:"mr-2 f-number"},[i("span",{staticClass:"font-s-12 text-red mr-1"},[e._v("已优惠：¥ "+e._s(e._f("numFixed2")(e.billDiscount)))]),e._v(" "),i("span",{staticClass:"font-s-14 text-hui2"},[e._v("实付金额：")]),e._v(" "),i("span",{staticClass:"font-s-14"},[e._v("¥")]),e._v(" "),i("span",{staticClass:"font-s-2 font-weight-bold"},[e._v(e._s(e._f("numFixed2")(e.billTotal)))])]),e._v(" "),i("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.doConfirm}},[e._v("确认结算")])],1)])],1)},n=[],s=(i("ac6a"),i("75fc")),l=(i("c5f6"),i("db72")),c=i("2f62"),r=i("5a0c"),o=i.n(r),u=i("8ded"),d=i.n(u),p=i("4d26"),f=i("c4c8"),v=i("73f5"),m=i("f007"),h=i("ba91"),b=i("c934"),_=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"u-pet box-shadow mb-2"},[i("el-avatar",{staticClass:"mr-1 flex-0",attrs:{size:45,src:e.info.avatar}}),e._v(" "),i("div",{staticClass:"flex-1"},[i("div",{staticClass:"mb-1"},[i("span",{staticClass:"font-weight-bold font-s-14"},[e._v(e._s(e.info.petName))]),e._v(" "),0===e.info.sex?i("span",{staticClass:"yc-icon yc-icon-gong",staticStyle:{color:"#1890ff"}}):i("span",{staticClass:"yc-icon yc-icon-mu",staticStyle:{color:"#eb2f96"}})]),e._v(" "),i("span",{staticClass:"u-pet__tag"},[e._v(e._s(e.info.petBreed))]),e._v(" "),e.info.petWeight?i("span",{staticClass:"u-pet__tag"},[e._v(e._s(e.info.petWeight)+"kg")]):e._e(),e._v(" "),i("span",{staticClass:"u-pet__tag"},[e._v(e._s(e.getYear(e.info.birthday))+"岁")])])],1)},g=[],y={name:"PetItem",props:{info:Object},methods:{getYear:function(e){return(o()().diff(e,"month")/12).toFixed(1)}}},C=y,k=(i("1800"),i("2877")),w=Object(k["a"])(C,_,g,!1,null,"60ca74a0",null),x=w.exports,S=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"u-sku-choose"},[i("el-dialog",{attrs:{"custom-class":"u-sku__dialog",width:"880px","close-on-click-modal":!1,visible:e.visible,"show-close":!1},on:{"update:visible":function(t){e.visible=t},close:e.handleClose}},[i("div",{staticClass:"flex align-center border-bottom-divider p-2",attrs:{slot:"title"},slot:"title"},[i("div",{staticClass:"u-type",class:{"u-type__active":1===e.type},on:{click:function(t){e.type=1}}},[e._v("服务")]),e._v(" "),i("div",{staticClass:"u-type",class:{"u-type__active":2===e.type},on:{click:function(t){e.type=2}}},[e._v("商品")])]),e._v(" "),i("service-choose",{directives:[{name:"show",rawName:"v-show",value:1===e.type,expression:"type === 1"}],ref:"service",attrs:{select:e.serviceSelect},on:{"update:select":function(t){e.serviceSelect=t}}}),e._v(" "),i("product-choose",{directives:[{name:"show",rawName:"v-show",value:2===e.type,expression:"type === 2"}],ref:"product",attrs:{select:e.productSelect},on:{"update:select":function(t){e.productSelect=t}}}),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("span",{staticClass:"font-s-13"},[i("span",{staticClass:"mr-1"},[e._v("\n          已选服务:\n          "),i("span",{staticClass:"text-main"},[e._v(e._s(e.serviceSelect.length)+"件")])]),e._v(" "),i("span",{staticClass:"mr-1"},[e._v("\n          已选商品:\n          "),i("span",{staticClass:"text-main"},[e._v(e._s(e.productSelect.length)+"件")])])]),e._v(" "),i("el-button",{staticClass:"yc-del",on:{click:function(t){e.visible=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{staticClass:"yc-btn",on:{click:e.handleConfirm}},[e._v("确 定")])],1)],1)],1)},P=[],L=i("2ef0"),N=i.n(L),z=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"flex border-bottom-divider"},[i("div",{staticClass:"u-sku__menu flex-0"},[i("el-tree",{ref:"tree",attrs:{data:e.serviceList,props:e.defaultProps,"highlight-current":"","current-node-key":e.menu.name,"node-key":"name"},on:{"node-click":e.handleNodeClick}})],1),e._v(" "),i("div",{staticClass:"u-sku__list p-1 flex-1",staticStyle:{width:"1px"}},[i("div",{staticClass:"flex align-center justify-between pb-1"},[i("div",[e._v("所属分类："+e._s(e.menu.name))]),e._v(" "),i("el-input",{staticClass:"u-search",attrs:{size:"mini",placeholder:"搜索服务名称","suffix-icon":"el-icon-search"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getList(t)}},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}})],1),e._v(" "),i("el-table",{ref:"table",staticStyle:{width:"100%"},attrs:{size:"small",data:e.list,height:"350px","empty-text":"暂无服务","row-key":"id"},on:{"row-click":e.clickRow,"selection-change":e.handleSelectionChange}},[i("el-table-column",{attrs:{type:"selection",width:"55",align:"center","reserve-selection":!0}}),e._v(" "),i("el-table-column",{attrs:{prop:"date",label:"服务内容",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.name))]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"date",label:"服务类目",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.category)+"-"+e._s(t.row.mealName))]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"originalPrice",label:"原价(元)",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",{staticClass:"f-number"},[e._v(e._s(t.row.originalPrice.toFixed(2)))])]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"memberPrice",label:"会员价(元)",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",{staticClass:"f-number"},[e._v(e._s(t.row.memberPrice.toFixed(2)))])]}}])})],1),e._v(" "),i("div",{staticClass:"u-page"},[i("el-pagination",{attrs:{small:"",background:"","current-page":e.pageNo,"page-sizes":[10,20,30,50],"page-size":e.pageSize,layout:"total, prev, pager, next",total:e.totalCount},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1)])},I=[],M=(i("7f7f"),i("22ce")),q={data:function(){return{keyword:"",pageNo:1,pageSize:10,totalCount:0,loading:!1,list:[],menu:{name:"全部服务"},serviceList:[{name:"全部服务"},{name:"洗澡",isCategory:!0,children:[]},{name:"美容",isCategory:!0,children:[]},{name:"寄养",isCategory:!0,children:[]},{name:"单项",isCategory:!0,children:[]},{name:"其他",isCategory:!0,children:[]}],defaultProps:{children:"children",label:"name"},selectedAll:[],selectedCurrent:[]}},mounted:function(){this.getMenuList(),this.getList()},methods:{clickRow:function(e){this.$refs.table.toggleRowSelection(e)},clear:function(){this.$refs.table.clearSelection()},handleSelectionChange:function(e){this.selectedCurrent=e,this.$emit("update:select",e)},handleNodeClick:function(e,t,i){e.isCategory?this.$refs.tree.setCurrentKey(this.menu.name):(this.menu=e,this.$refs.tree.setCurrentKey(e.name),this.pageNo=1,this.keyword="",this.getList())},getList:function(){var e=this,t={pageNo:this.pageNo,pageSize:this.pageSize,mealName:"",category:"",name:this.keyword};"全部服务"!==this.menu.name&&(this.menu.isCategory?t.category=this.menu.name:t.id=this.menu.id),M["a"].queryList(t).then((function(t){e.list=t.data.items,e.totalCount=t.data.totalCount}))},handleSizeChange:function(e){this.pageSize=e,this.getList()},handleCurrentChange:function(e){this.pageNo=e,this.getList()},getMenuList:function(){var e=this;M["a"].queryTreeList({pageSize:999,pageNo:1}).then((function(t){var i=N.a.get(t.data,"items",[]);e.serviceList.forEach((function(e){return e.children=[]})),i.forEach((function(t){var i={"洗澡":1,"美容":2,"寄养":3,"单项":4,"其他":5};e.serviceList[i[t.category]].children.push(t)}))}))}}},$=q,T=(i("8243"),Object(k["a"])($,z,I,!1,null,"6cad33be",null)),B=T.exports,O=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"flex border-bottom-divider"},[i("div",{staticClass:"u-sku__menu flex-0"},[i("el-tree",{ref:"tree",attrs:{data:e.serviceList,props:e.defaultProps,"highlight-current":"","current-node-key":e.menu.categoryName,"node-key":"categoryName"},on:{"node-click":e.handleNodeClick}})],1),e._v(" "),i("div",{staticClass:"u-sku__list p-1 flex-1",staticStyle:{width:"1px"}},[i("div",{staticClass:"flex align-center justify-between pb-1"},[i("div",[e._v("所属分类："+e._s(e.menu.categoryName))]),e._v(" "),i("el-input",{staticClass:"u-search",attrs:{size:"mini",placeholder:"搜索商品名称/条形码","suffix-icon":"el-icon-search"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getList(t)}},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}})],1),e._v(" "),i("el-table",{ref:"table",staticStyle:{width:"100%"},attrs:{size:"small",data:e.list,height:"350px","empty-text":"暂无商品","row-key":"id"},on:{"row-click":e.clickRow,"selection-change":e.handleSelectionChange}},[i("el-table-column",{attrs:{type:"selection",width:"55",align:"center","reserve-selection":!0}}),e._v(" "),i("el-table-column",{attrs:{prop:"skuName",label:"图片",align:"center",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-image",{staticStyle:{width:"40px",height:"40px"},attrs:{src:e.url2Webp(t.row.skuImgUrl),webp:""}})]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"skuName",label:"商品名称",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.skuName))]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"stock",label:"库存",align:"center",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",{staticClass:"f-number"},[e._v(e._s(t.row.stock))])]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"price",label:"价格(元)",align:"center",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",{staticClass:"f-number"},[e._v(e._s(t.row.price.toFixed(2)))])]}}])})],1),e._v(" "),i("div",{staticClass:"u-page"},[i("el-pagination",{attrs:{small:"",background:"","current-page":e.pageNo,"page-sizes":[10,20,30,50],"page-size":e.pageSize,layout:"total, prev, pager, next",total:e.totalCount},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1)])},j=[],F=i("c405"),E={data:function(){return{keyword:"",pageNo:1,pageSize:10,totalCount:0,loading:!1,list:[],menu:{categoryName:"全部商品"},serviceList:[{categoryName:"全部商品"}],defaultProps:{children:"children",label:"categoryName"},selectedCurrent:[]}},mounted:function(){this.getMenuList(),this.getList()},methods:{clickRow:function(e){this.$refs.table.toggleRowSelection(e)},clear:function(){this.$refs.table.clearSelection()},handleSelectionChange:function(e){this.selectedCurrent=e,this.$emit("update:select",e)},handleNodeClick:function(e,t,i){this.menu.categoryName!==e.categoryName&&(this.menu=e,this.$refs.tree.setCurrentKey(e.categoryName),this.pageNo=1,this.keyword="",this.getList())},getList:function(){var e=this,t={pageNo:this.pageNo,pageSize:this.pageSize,categoryId:this.menu.id,keyword:this.keyword};f["a"].queryProductSkuList(t).then((function(t){e.list=t.data.items,e.totalCount=t.data.totalCount}))},handleSizeChange:function(e){this.pageSize=e,this.getList()},handleCurrentChange:function(e){this.pageNo=e,this.getList()},getMenuList:function(){var e=this;F["a"].queryProductCategory({pageSize:999,pageNo:1}).then((function(t){var i=N.a.get(t,"data",[]);e.serviceList=[].concat(Object(s["a"])(e.serviceList),Object(s["a"])(i))}))}}},R=E,U=(i("2ae2"),Object(k["a"])(R,O,j,!1,null,"1ba17511",null)),D=U.exports,V={name:"SkuChoose",components:{ServiceChoose:B,ProductChoose:D},data:function(){return{serviceSelect:[],productSelect:[],visible:!1,type:1}},methods:{show:function(){var e=this;this.visible=!0,this.serviceSelect=[],this.productSelect=[],this.$nextTick((function(){e.$refs.service.clear(),e.$refs.product.clear()}))},handleConfirm:function(){this.$emit("choose",N.a.cloneDeep({serviceSelect:this.serviceSelect,productSelect:this.productSelect})),this.visible=!1},handleClose:function(){this.$emit("close")}}},Y=V,A=(i("865b"),i("efe4"),Object(k["a"])(Y,S,P,!1,null,"1f7e18fe",null)),J=A.exports,K=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"u-bill flex align-center"},[i("span",{staticClass:"u-bill__add el-icon-plus px-1",on:{click:e.addBill}}),e._v(" "),i("div",{staticClass:"u-bill__wrap inline-flex align-center bg-bai text-hui2"},e._l(e.list,(function(t,a){return i("div",{key:t.name,staticClass:"flex-0",class:{"u-bill__active":t.id===e.value},on:{click:function(i){return e.handleClick(t.id)}}},[i("div",{staticClass:"u-bill__item"},[i("span",{staticClass:"mr-1"},[e._v(e._s(t.title))]),e._v(" "),i("span",{staticClass:"el-icon-close text-base",on:{click:function(i){return i.stopPropagation(),e.delBill(a,t.id)}}})])])})),0)])},W=[],G={name:"BillMenu",props:{value:[Number,String],list:Array},methods:{handleClick:function(e){this.$emit("input",e)},addBill:function(){this.$emit("add")},delBill:function(e,t){this.$emit("delete",{index:e,id:t})}}},H=G,Q=(i("b08b"),Object(k["a"])(H,K,W,!1,null,"5516c0a3",null)),X=Q.exports,Z=function(e,t){return 0===t?{productType:t,id:e.id,skuId:e.id,name:e.skuName,imgUrl:e.skuImgUrl,price:e.price,memberPrice:e.price,quantity:1,percent:100,total:1*e.price}:1===t?{productType:t,id:e.id,skuId:"",name:e.name+"-"+e.mealName+"-"+e.category,imgUrl:"",price:e.originalPrice,memberPrice:e.memberPrice||e.originalPrice,quantity:1,percent:e.memberPrice?+(e.memberPrice/e.originalPrice*100).toFixed(2):100,total:e.memberPrice||e.originalPrice}:void 0},ee={name:"Cashier",components:{SkuChoose:J,YcUserChoose:m["a"],BillMenu:X,YcTabs:h["a"],YcBlock:b["a"],PetItem:x},data:function(){return{printCount:1,needPrint:!0,showConfrim:!1,visible:!1,isStart:!0,loading:!1,keyword:"",bills:[],billId:"",vipMember:d.a.get("VIP_MEMBER"),vipMemberTab:"会员概况",saleTime:"",payType:"",payList:[{label:"微信",value:0,icon:i("613e")},{label:"支付宝",value:1,icon:i("060a")},{label:"现金",value:2,icon:i("e1ee")},{label:"余额",value:3,icon:i("40e2")}]}},computed:Object(l["a"])({},Object(c["c"])({storeInfo:function(e){return e.store.store}}),{activeBill:function(){var e=this;return this.bills.filter((function(t){return t.id===e.billId}))[0]},billTotal:function(){var e=this.activeBill.list.reduce((function(e,t){return e+Number(t.total)}),0);return e},billDiscount:function(){var e=this.activeBill.list.reduce((function(e,t){return e+t.quantity*t.price}),0);return e-this.billTotal},showPayList:function(){return this.vipMember?this.payList:this.payList.filter((function(e){return 3!==e.value}))}}),watch:{vipMember:function(e){e?d.a.set("VIP_MEMBER",e):d.a.remove("VIP_MEMBER")},needPrint:function(e){}},created:function(){var e=this;this.addBill(),this._scanner=this.$scanner({callback:function(t){e.isStart&&t&&(e.keyword=t,e.addSku())}})},beforeDestroy:function(){this._scanner.cancel()},methods:{addSpecalSku:function(){var e=this.uuid();this.activeBill.list.push({productType:3,id:e,skuId:e,name:"差价商品",imgUrl:"",price:1,memberPrice:1,quantity:1,percent:100,total:1})},delVipMember:function(){this.vipMember=null},calcChange:function(e,t){"quantity"===t&&(e.total=(e.memberPrice*e.quantity).toFixed(2)),"price"===t&&(e.percent=(e.memberPrice/e.price*100).toFixed(2)),"percent"===t&&(e.memberPrice=(e.price*(e.percent/100)).toFixed(2),e.total=(e.memberPrice*e.quantity).toFixed(2)),"memberPrice"===t&&(e.percent=(e.memberPrice/e.price*100).toFixed(2),e.total=(e.memberPrice*e.quantity).toFixed(2)),"total"===t&&(e.memberPrice=(e.total/e.quantity).toFixed(2),e.percent=(e.memberPrice/e.price*100).toFixed(2)),e.quantity=+e.quantity,e.price=+e.price,e.percent=+e.percent,e.memberPrice=+e.memberPrice,e.total=+e.total},handleChooseUser:function(){this.$refs.userChoose.show()},doEmpty:function(){this.activeBill.list=[]},handleAddSku:function(e){var t=e.serviceSelect,i=e.productSelect;i=i.map((function(e){return Z(e,0)})),t=t.map((function(e){return Z(e,1)}));var a=Object(s["a"])(t),n=this.activeBill.list;i.forEach((function(e){var t=n.filter((function(t){return t.id===e.id&&e.productType===t.productType}))[0];t?t.quantity+=1:a.push(e)})),this.activeBill.list=[].concat(Object(s["a"])(n),Object(s["a"])(a))},showSkuChoose:function(){this.$refs.skuChoose.show(),this.isStart=!1},recoverData:function(){},saveData:function(){},doSubmit:function(){0!==this.activeBill.list.length?(this.payType="",this.saleTime=Date.now(),this.showConfrim=!0):this.$message.warning("请先添加商品")},doConfirm:function(){var e=this;if(""===this.payType)return this.$message.warning("请先选择付款方式");var t=this.activeBill.list.reduce((function(e,t){return e+t.quantity*t.price}),0),i=this.billTotal,a=this.activeBill.list.reduce((function(e,t){return e+t.quantity}),0),n={uid:this.vipMember?this.vipMember.uid:"",remark:"",payType:this.payType,storeId:this.storeInfo.id,totalFee:t,discountFee:t-i,paidFee:i,skuCount:a,skuJsonString:this.activeBill.list};v["a"].insertOrder(n).then((function(t){if(e.$notify({title:"成功",message:"下单完成",type:"success"}),e.showConfrim=!1,e.activeBill.list=[],e.needPrint){var i=Object(l["a"])({},n,{orderId:t.data});Object(p["a"])({storeInfo:e.storeInfo,orderInfo:i,count:e.printCount})}}))},toggleSelection:function(e){var t=this;e.forEach((function(e){t.$refs.multipleTable.toggleRowSelection(e,!0)}))},handleSelectionChange:function(e){this.activeBill.selected=e},addBill:function(){var e={id:this.uuid(),title:"账单",list:[],selected:[]};this.bills.push(e),this.billId=e.id},delBill:function(e){var t=e.index,i=e.id;if(1!==this.bills.length){var a;if(this.billId===i)a=t>0?this.bills[t-1].id:this.bills[t+1].id,this.billId=a;this.bills.splice(t,1)}},deleteSku:function(e){this.activeBill.list=this.activeBill.list.filter((function(t){return t.productType!==e.productType||t.id!==e.id}))},addSku:function(){var e=this;this.loading=!0,f["a"].querySkuByCode({code:this.keyword}).then((function(t){if(t.data){var i=e.activeBill.list,a=t.data;a=Z(a,0);var n=i.filter((function(e){return e.id===a.id&&a.productType===e.productType}))[0];n?(n.quantity+=1,e.calcChange(n,"quantity")):e.activeBill.list.push(a),e.keyword=""}else e.$message.warning("未查询到商品")})).catch((function(){})).finally((function(){e.loading=!1}))}}},te=ee,ie=(i("c327"),Object(k["a"])(te,a,n,!1,null,"7b2c69a6",null));t["default"]=ie.exports},"2ae2":function(e,t,i){"use strict";var a=i("206c"),n=i.n(a);n.a},"355b":function(e,t,i){},"412a":function(e,t,i){},"472c":function(e,t,i){},6325:function(e,t,i){"use strict";var a=i("d243"),n=i.n(a);n.a},8243:function(e,t,i){"use strict";var a=i("412a"),n=i.n(a);n.a},"865b":function(e,t,i){"use strict";var a=i("0bfa"),n=i.n(a);n.a},afc7:function(e,t,i){},b04e:function(e,t,i){},b08b:function(e,t,i){"use strict";var a=i("355b"),n=i.n(a);n.a},c327:function(e,t,i){"use strict";var a=i("472c"),n=i.n(a);n.a},c405:function(e,t,i){"use strict";var a=i("365c");t["a"]={queryProductCategory:function(e){return a["a"].post("/admin/queryProductCategory",e)},saveOrUpdate:function(e){return a["a"].post("/admin/productCategory/saveOrUpdate",e)},del:function(e){return a["a"].get("/admin/productCategory/del",e)}}},c4c8:function(e,t,i){"use strict";var a=i("365c");t["a"]={queryProducts:function(e){return a["a"].post("/admin/queryProducts",e)},queryProductFullInfoById:function(e){return a["a"].get("/admin/queryProductFullInfoById",e)},queryProductCategory:function(e){return a["a"].post("/admin/queryProductCategory",e)},insertProduct:function(e){return a["a"].post("/admin/insertProduct",e)},updateProduct:function(e){return a["a"].post("/admin/updateProduct",e)},deleteProduct:function(e){return a["a"].post("/admin/deleteProduct",e)},querySkuByCode:function(e){return a["a"].get("/admin/querySku/byCode",e)},queryProductSkuList:function(e){return a["a"].post("/admin/queryProductSkuList",e)}}},d243:function(e,t,i){},efe4:function(e,t,i){"use strict";var a=i("afc7"),n=i.n(a);n.a},f007:function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{attrs:{"show-close":!1,visible:e.showChoose,width:"700px"},on:{"update:visible":function(t){e.showChoose=t}}},[i("div",{staticClass:"text-center",attrs:{slot:"title"},slot:"title"},[e._v("用户选择")]),e._v(" "),i("div",{staticClass:"u-filter flex justify-end mb-1"},[i("el-input",{staticClass:"yc-input",staticStyle:{width:"250px"},attrs:{size:"mini",placeholder:"会员姓名、编号、手机号/宠物昵称"},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}},[i("i",{staticClass:"el-icon-search",staticStyle:{width:"25px","line-height":"28px"},attrs:{slot:"suffix"},slot:"suffix"})])],1),e._v(" "),i("el-table",{ref:"table",staticStyle:{width:"100%"},attrs:{data:e.list,size:"mini","row-key":"uid"},on:{"row-click":e.clickRow,"selection-change":e.handleSelectionChange}},[e.single?i("el-table-column",{attrs:{width:"55",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-checkbox",{attrs:{value:e.selected&&t.row.uid===e.selected.uid}})]}}])}):i("el-table-column",{attrs:{type:"selection",width:"55",align:"center","reserve-selection":!0}}),e._v(" "),i("el-table-column",{attrs:{prop:"avatar",label:"头像",align:"center"},scopedSlots:e._u([{key:"default",fn:function(e){return[i("el-avatar",{attrs:{src:e.row.avatar}})]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"nickname",label:"微信昵称",align:"center"}}),e._v(" "),i("el-table-column",{attrs:{prop:"name",label:"名称",align:"center"}}),e._v(" "),i("el-table-column",{attrs:{prop:"vipName",label:"用户等级",align:"center"}}),e._v(" "),i("el-table-column",{attrs:{prop:"mobile",label:"联系方式",align:"center"}}),e._v(" "),i("el-table-column",{attrs:{prop:"balance",label:"余额",align:"center"}})],1),e._v(" "),i("div",{staticClass:"u-page"},[i("el-pagination",{attrs:{small:"",background:"","current-page":e.pageNo,"page-size":e.pageSize,layout:"total, prev, pager, next",total:e.totalCount},on:{"current-change":e.handleCurrentChange}})],1),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{staticClass:"yc-del",on:{click:function(t){e.showChoose=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{staticClass:"yc-btn",on:{click:e.doConfirm}},[e._v("确 定")])],1)],1)},n=[],s=i("c24f"),l={name:"YcUserChoose",props:{value:[Array,Object],single:Boolean},data:function(){return{keyword:"",showChoose:!1,list:[],selectedList:[],selected:null,pageNo:1,pageSize:10,totalCount:0}},methods:{doConfirm:function(){this.single?this.$emit("input",this.selected):this.$emit("input",this.selectedList),this.showChoose=!1},clickRow:function(e){this.single?this.selected=e:this.$refs.table.toggleRowSelection(e)},handleSelectionChange:function(e){this.selectedList=e},show:function(){var e=this;this.showChoose=!0,this.pageNo=1,this.list=[],this.keyword="",this.getList(),this.single?this.selected=this.value:this.$nextTick((function(){e.$refs.table.clearSelection(),e.value.map((function(t){e.$refs.table.toggleRowSelection(t,!0)}))}))},getList:function(){var e=this;s["a"].queryVipList({pageNo:this.pageNo,pageSize:this.pageSize}).then((function(t){e.list=t.data.items,e.totalCount=t.data.totalCount}))},handleCurrentChange:function(e){this.pageNo=e,this.getList()}}},c=l,r=(i("6325"),i("2877")),o=Object(r["a"])(c,a,n,!1,null,"43114573",null);t["a"]=o.exports}}]);