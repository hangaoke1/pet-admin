(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1b3f42d4"],{"09b2":function(e,t,n){"use strict";var a=n("f08f"),s=n.n(a);s.a},"365c":function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var a=n("db72"),s=n("bc3a"),r=n.n(s),i=n("5c96"),l=n("4360"),o=n("5f87"),u=r.a.create({baseURL:"http://81.68.144.150:8088",withCredentials:!0,timeout:5e3});u.interceptors.request.use((function(e){return l["a"].getters.token&&(e.headers["Authorization"]=Object(o["a"])()),e}),(function(e){return Promise.reject(e)})),u.interceptors.response.use((function(e){var t=e.data;return 200!==t.code?(Object(i["Message"])({message:t.message||"Error",type:"error",duration:5e3}),999===t.code&&"/login"!==window.gvm.$route.path&&i["MessageBox"].confirm("登录状态已经过期",{confirmButtonText:"重新登录",cancelButtonText:"取消",type:"warning"}).then((function(){l["a"].dispatch("user/resetToken").then((function(){location.reload()}))})),Promise.reject(new Error(t.message||"Error"))):t.data}),(function(e){return console.log("接口异常"+e),Object(i["Message"])({message:e.message,type:"error",duration:5e3}),Promise.reject(e)}));var c=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return u.get(e,Object(a["a"])({params:t},n))},d=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return u.post(e,t,n)},p={get:c,post:d}},"95d1":function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"u-page__product"},[n("div",{staticClass:"u-productAdd"},[e._m(0),e._v(" "),n("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules,"label-width":"80px"}},[n("el-form-item",{attrs:{label:"商品名称",prop:"name"}},[n("el-input",{staticStyle:{width:"400px"},attrs:{size:"small",placeholder:"商品标题组成：商品描述+规格"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"商品品牌"}},[n("el-input",{staticStyle:{width:"400px"},attrs:{size:"small",placeholder:"请填写品牌"},model:{value:e.form.brand,callback:function(t){e.$set(e.form,"brand",t)},expression:"form.brand"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"商品产地"}},[n("el-input",{staticStyle:{width:"400px"},attrs:{size:"small",placeholder:"请填写产地"},model:{value:e.form.address,callback:function(t){e.$set(e.form,"address",t)},expression:"form.address"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"适用对象",prop:"petType"}},[n("el-select",{attrs:{clearable:"",placeholder:"请选择",size:"small"},model:{value:e.form.petType,callback:function(t){e.$set(e.form,"petType",t)},expression:"form.petType"}},e._l(e.options,(function(e){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),e._v(" "),n("el-form-item",{attrs:{label:"商品分类",prop:"categoryId"}},[n("el-select",{attrs:{clearable:"",placeholder:"请选择",size:"small"},model:{value:e.form.categoryId,callback:function(t){e.$set(e.form,"categoryId",t)},expression:"form.categoryId"}},e._l(e.categoryOptions,(function(e){return n("el-option",{key:e.id,attrs:{label:e.categoryName,value:e.id}})})),1)],1),e._v(" "),n("el-form-item",{attrs:{label:"上架状态"}},[n("el-switch",{model:{value:e.form.onOff,callback:function(t){e.$set(e.form,"onOff",t)},expression:"form.onOff"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"商品描述"}},[n("el-input",{staticStyle:{width:"400px"},attrs:{rows:"5",type:"textarea",placeholder:"建议300字以内，未填写讲根据商品标题自动生成"},model:{value:e.form.detail,callback:function(t){e.$set(e.form,"detail",t)},expression:"form.detail"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"商品轮播",prop:"productImgUrl"}},[n("el-upload",{attrs:{"list-type":"picture-card",action:e.uploadUrl,"on-preview":e.handleBannerPreview,"on-remove":e.handleBannerRemove,"on-success":e.handleBannerSuccess,"file-list":e.fileList}},[n("i",{staticClass:"el-icon-plus"})]),e._v(" "),n("el-dialog",{attrs:{visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[n("img",{attrs:{width:"100%",src:e.dialogImageUrl,alt:""}})]),e._v(" "),n("div",{staticClass:"u-tip"},[e._v("请至少上传一张轮播图片，推荐尺寸400x400")])],1)],1),e._v(" "),e._m(1),e._v(" "),n("el-form",{ref:"form",attrs:{"label-width":"80px"}},[n("el-form-item",{attrs:{label:"商品规格"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:e.specs.length,expression:"specs.length"}],staticClass:"u-specs__tip"},[e._v("最多添加两个商品规格")]),e._v(" "),e._l(e.specs,(function(t,a){return n("div",{key:a,staticClass:"u-specs__item"},[n("div",{staticClass:"u-specs__header"},[n("el-select",{attrs:{size:"small",placeholder:"规格"+(a+1)},on:{change:function(n){return e.handleTypeChagne(t,n)}},model:{value:t.type,callback:function(n){e.$set(t,"type",n)},expression:"sp.type"}},e._l(e.getOptions(a),(function(e){return n("el-option",{key:e.type,attrs:{label:e.name,value:e.type}})})),1),e._v(" "),n("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){return e.deleteSpecs(a)}}},[e._v("删除规格")])],1),e._v(" "),t.type?n("div",{staticClass:"u-enum"},[n("div",{staticClass:"u-enum__list"},e._l(t.val,(function(a){return n("el-tag",{key:a,staticClass:"u-enum__item",attrs:{closable:"","disable-transitions":!1,type:"info"},on:{close:function(n){return e.handleEnumClose(t,a)}}},[e._v(e._s(a))])})),1),e._v(" "),n("div",[n("el-input",{staticStyle:{width:"100px"},attrs:{size:"mini"},model:{value:t.enum,callback:function(n){e.$set(t,"enum","string"===typeof n?n.trim():n)},expression:"sp.enum"}}),e._v(" "),n("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(n){return e.handleAddEnum(t)}}},[e._v("添加")])],1)]):e._e()])})),e._v(" "),n("el-button",{directives:[{name:"show",rawName:"v-show",value:e.specs.length<2,expression:"specs.length < 2"}],attrs:{icon:"el-icon-plus",size:"small"},on:{click:e.addSpecs}},[e._v("添加规格")])],2)],1),e._v(" "),e._m(2),e._v(" "),n("el-table",{staticStyle:{width:"100%"},attrs:{data:e.skuList}},[1===e.effectSpecs.length?[n("el-table-column",{attrs:{label:e.specs[0].name,width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[n("span",[e._v(e._s(a.specs[0].value))])]}}],null,!1,2617394593)})]:e._e(),e._v(" "),2===e.effectSpecs.length?[n("el-table-column",{attrs:{label:e.specs[0].name,width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[n("span",[e._v(e._s(a.specs[0].value))])]}}],null,!1,2617394593)}),e._v(" "),n("el-table-column",{attrs:{label:e.specs[1].name,width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[n("span",[e._v(e._s(a.specs[1].value))])]}}],null,!1,3241940608)})]:e._e(),e._v(" "),n("el-table-column",{attrs:{"label-class-name":"u-require",label:"sku名称",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[n("el-input",{attrs:{size:"small"},model:{value:a.skuName,callback:function(t){e.$set(a,"skuName",t)},expression:"row.skuName"}})]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"sku原价",width:"150",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[n("el-input-number",{attrs:{"controls-position":"right",min:0,max:99999,size:"small"},model:{value:a.originPrice,callback:function(t){e.$set(a,"originPrice",t)},expression:"row.originPrice"}})]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"sku进货价",width:"150",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[n("el-input-number",{attrs:{"controls-position":"right",min:0,max:99999,size:"small"},model:{value:a.supplyPrice,callback:function(t){e.$set(a,"supplyPrice",t)},expression:"row.supplyPrice"}})]}}])}),e._v(" "),n("el-table-column",{attrs:{"label-class-name":"u-require",label:"sku价格",width:"150",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[n("el-input-number",{attrs:{"controls-position":"right",min:0,max:99999,size:"small"},model:{value:a.price,callback:function(t){e.$set(a,"price",t)},expression:"row.price"}})]}}])}),e._v(" "),n("el-table-column",{attrs:{"label-class-name":"u-require",label:"sku库存",width:"150",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[n("el-input-number",{attrs:{"controls-position":"right",min:0,max:99999,size:"small"},model:{value:a.stock,callback:function(t){e.$set(a,"stock",t)},expression:"row.stock"}})]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"商品类型",width:"120",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[n("el-select",{attrs:{placeholder:"请选择"},model:{value:a.hotFlag,callback:function(t){e.$set(a,"hotFlag",t)},expression:"row.hotFlag"}},e._l(e.hotFlagOptions,(function(e){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)]}}])}),e._v(" "),n("el-table-column",{attrs:{"label-class-name":"u-require",label:"sku小图(400x400)","min-width":"200",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[n("el-upload",{attrs:{action:e.uploadUrl,"show-file-list":!1,"on-success":e.handleSmallSuccess.bind(this,a),"before-upload":e.beforeUpload}},[a.skuImgUrl?n("el-image",{staticStyle:{width:"50px",height:"50px"},attrs:{src:a.skuImgUrl,fit:"fill",lazy:"",webp:""}}):n("el-button",{attrs:{type:"primary",size:"mini"}},[e._v("\n              上传图片\n              "),n("i",{staticClass:"el-icon-upload el-icon--right"})])],1)]}}])}),e._v(" "),n("el-table-column",{attrs:{"label-class-name":"u-require",label:"sku详情图(750x2000)","min-width":"200",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[n("el-upload",{attrs:{action:e.uploadUrl,"show-file-list":!1,"on-success":e.handleDetailSuccess.bind(this,a),"before-upload":e.beforeUpload}},[a.skuDetailImgUrl?n("el-image",{staticStyle:{width:"50px",height:"50px"},attrs:{src:a.skuDetailImgUrl,fit:"fill",lazy:"",webp:""}}):n("el-button",{attrs:{type:"primary",size:"mini"}},[e._v("\n              上传图片\n              "),n("i",{staticClass:"el-icon-upload el-icon--right"})])],1)]}}])})],2)],1),e._v(" "),n("div",{staticClass:"u-submit"},[n("el-button",{attrs:{loading:e.submitLoading,type:"primary"},on:{click:e.handleSubmit}},[e._v(e._s(e.isEdit?"更新商品":"提交发布"))])],1)])},s=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("h1",{staticClass:"u-title"},[n("span",{staticClass:"u-index"},[e._v("1")]),e._v("商品基本信息\n    ")])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("h1",{staticClass:"u-title"},[n("span",{staticClass:"u-index"},[e._v("2")]),e._v("商品规格与库存\n    ")])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("h1",{staticClass:"u-title"},[n("span",{staticClass:"u-index"},[e._v("3")]),e._v("价格及库存\n    ")])}],r=n("75fc"),i=(n("ac6a"),n("db72")),l=(n("7f7f"),n("2ef0")),o=n.n(l),u=n("8ded"),c=n.n(u),d=n("c4c8"),p=[{type:"weight",name:"重量"},{type:"shap",name:"形状"},{type:"size",name:"尺寸"},{type:"package",name:"套餐"},{type:"taste",name:"口味"}],f={};p.forEach((function(e){f[e.type]=e}));var m=function(){return{skuName:"",skuImgUrl:"",skuDetailImgUrl:"",originPrice:"",supplyPrice:"",price:"",stock:"",specs:null}},h={name:"productDetail",props:{isEdit:Boolean},data:function(){var e=function(e,t,n){o.a.get(t,"length")?n():n(new Error("至少上传一张图片"))};return{doingSave:!1,submitLoading:!1,enum1:"",enum2:"",specsList:p,specsMap:f,form:{categoryId:"",petType:"",name:"",brand:"",address:"",detail:"",onOff:!0,productImgUrl:[]},specs:[],skuList:[],dialogVisible:!1,dialogImageUrl:"",fileList:[],options:[{label:"通用",value:0},{label:"狗狗",value:1},{label:"猫咪",value:2}],hotFlagOptions:[{value:0,label:"普通"},{value:1,label:"新品"},{value:2,label:"折扣"}],categoryOptions:[],rules:{categoryId:{required:!0,message:"请选择商品分类",trigger:"change"},petType:{required:!0,message:"请选择适用对象",trigger:"change"},name:{required:!0,message:"请输入名称",trigger:"blur"},productImgUrl:{required:!0,validator:e,trigger:"change"}}}},computed:{effectSpecs:function(){return this.specs.filter((function(e){return!!e.val.length}))}},watch:{fileList:function(e){var t=this;this.form.productImgUrl=e.map((function(e){return{imgUrl:e.url}})),this.$nextTick((function(){t.$refs.ruleForm.validateField("productImgUrl")}))}},mounted:function(){this.init(),this.genSku(),this.queryProductCategory()},beforeRouteLeave:function(e,t,n){n()},methods:{init:function(){this.isEdit&&(this.tempRoute=Object.assign({},this.$route),this.queryProductFullInfoById())},setTagsViewTitle:function(){var e="商品编辑",t=Object.assign({},this.tempRoute,{title:"".concat(e,"-").concat(this.$route.params.productId)});this.$store.dispatch("tagsView/updateVisitedView",t)},setPageTitle:function(){var e="商品编辑";document.title="".concat(e," - ").concat(this.$route.params.productId)},queryProductFullInfoById:function(){var e=this;d["a"].queryProductFullInfoById({productId:this.$route.params.productId}).then((function(t){e.setTagsViewTitle(),e.setPageTitle(),c.a.set("product_edit",t),e.recoverData(t)}))},recoverData:function(e){var t=e.product,n=e.productSkuList,a=e.productBannerImgList;this.form={categoryId:t.categoryId,petType:t.petType,name:t.name,brand:t.brand,address:t.address,detail:t.detail,onOff:0===t.onOff,productImgUrl:[]},this.specs=t.specs||[],this.skuList=n,this.fileList=a.map((function(e){return{uid:e.imgUrl,url:e.imgUrl}}))},handleSubmit:function(){var e=this;this.$refs["ruleForm"].validate((function(t){if(!t)return!1;e.checkSku().then((function(){var t=e.genParams();e.submitLoading||(e.submitLoading=!0,e.isEdit?d["a"].updateProduct(t).then((function(t){e.$message.success("更新商品成功"),e.submitLoading=!1,e.init()})).catch((function(t){console.error(t),e.submitLoading=!1})):d["a"].insertProduct(t).then((function(t){e.$message.success("新增商品成功"),e.submitLoading=!1})).catch((function(t){e.submitLoading=!1,e.$message.error(t.message)})))})).catch((function(t){e.$message.error(t.message)}))}))},genParams:function(){var e=Object(i["a"])({},this.form,{onOff:this.form.onOff?0:1,specList:this.specs.filter((function(e){return!!o.a.get(e,"val.length")})).map((function(e){return{name:e.name,type:e.type,val:e.val}})),skuInfoList:this.skuList});if(this.isEdit){var t=c.a.get("product_edit"),n=t.product;e.id=n.id,e.productId=n.productId}return e},checkSku:function(){var e=this;return new Promise((function(t,n){for(var a=e.skuList,s=0;s<a.length;s++){var r=a[s];if(""===r.skuName||""===r.skuImgUrl||""===r.skuDetailImgUrl||""===r.price||""===r.stock)return void n(new Error("第".concat(s+1,"个商品内容存在空情况，请补充完整")))}t()}))},handleSmallSuccess:function(e,t,n){e.skuImgUrl=t.data},handleDetailSuccess:function(e,t,n){e.skuDetailImgUrl=t.data},beforeUpload:function(){return!0},queryProductCategory:function(){var e=this;d["a"].queryProductCategory().then((function(t){e.categoryOptions=t||[]}))},getOptions:function(e){var t=0===e?1:0,n=this.specs[t];return n&&n.type?this.specsList.filter((function(e){return e.type!==n.type})):this.specsList},genSku:function(){var e=this,t=this.specs.filter((function(e){return!!e.val.length})),n=[];0===t.length&&n.push(m()),1===t.length&&t[0].val.forEach((function(e){var a={type:t[0].type,name:t[0].name,value:e},s=m();s.specs=[a],n.push(s)})),2===t.length&&t[0].val.forEach((function(e){var a={type:t[0].type,name:t[0].name,value:e};t[1].val.forEach((function(e){var s={type:t[1].type,name:t[1].name,value:e},r=m();r.specs=[a,s],n.push(r)}))})),n.forEach((function(t){e.skuList.forEach((function(n){e.isSameSpeces(t.specs||[],n.specs||[])&&Object.assign(t,n)}))})),this.skuList=n},isSameSpeces:function(e,t){if(t.length!==e.length)return!1;var n=o.a.differenceWith(e,t,(function(e,t){return e.type===t.type&&e.value===t.value}));return 0===n.length},handleEnumClose:function(e,t){e.val=e.val.filter((function(e){return e!==t})),this.genSku()},handleAddEnum:function(e){e.enum&&(e.val=o.a.uniq([].concat(Object(r["a"])(e.val),[e.enum])),e.enum="",this.genSku())},handleTypeChagne:function(e,t){e.name=this.specsMap[t].name},addSpecs:function(){this.specs.push({type:"",name:"",val:[],enum:""})},deleteSpecs:function(e){this.specs.splice(e,1),this.genSku()},handleBannerSuccess:function(e,t,n){t.url=e.data,this.fileList=n},handleBannerRemove:function(e,t){this.fileList=t},handleBannerPreview:function(e){this.dialogImageUrl=e.url,this.dialogVisible=!0}}},v=h,g=(n("e3c5"),n("09b2"),n("2877")),b=Object(g["a"])(v,a,s,!1,null,"5323d302",null);t["a"]=b.exports},c4c8:function(e,t,n){"use strict";var a=n("365c");t["a"]={queryProducts:function(e){return a["a"].post("/admin/queryProducts",e)},queryProductFullInfoById:function(e){return a["a"].get("/admin/queryProductFullInfoById",e)},queryProductCategory:function(e){return a["a"].post("/admin/queryProductCategory",e)},insertProduct:function(e){return a["a"].post("/admin/insertProduct",e)},updateProduct:function(e){return a["a"].post("/admin/updateProduct",e)},deleteProduct:function(e){return a["a"].post("/admin/deleteProduct",e)}}},e3c5:function(e,t,n){"use strict";var a=n("ffc0"),s=n.n(a);s.a},f08f:function(e,t,n){},ffc0:function(e,t,n){}}]);